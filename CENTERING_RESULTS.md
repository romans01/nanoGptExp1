# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ nanoGPT

## üéØ –¶–µ–ª—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–µ—Ö–Ω–∏–∫–∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É nanoGPT –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏.

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª—è—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —á–∞—Å—Ç–æ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —É–∑–∫–æ–º –∫–æ–Ω—É—Å–µ –Ω–∞ –µ–¥–∏–Ω–∏—á–Ω–æ–π —Å—Ñ–µ—Ä–µ (–∞–Ω–∏–∑–æ—Ç—Ä–æ–ø–∏—è), —á—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∏—Ö –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–∏–≤–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –ø–µ—Ä–µ–Ω–æ—Ä–º–∏—Ä–æ–≤–∫–æ–π:
1. –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–Ω—Ç—Ä–æ–∏–¥ –≤–µ–∫—Ç–æ—Ä–æ–≤: `c = mean(vectors)`
2. –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º: `v_centered = v - c`
3. –ü–µ—Ä–µ–Ω–æ—Ä–º–∏—Ä—É–µ–º: `v_normalized = v_centered / ||v_centered||`

**–≠—Ñ—Ñ–µ–∫—Ç:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —É–≥–ª–æ–≤ –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏, –ª—É—á—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π.

## üî¨ –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏:
- **–°–ª–æ–∏:** 6
- **–ì–æ–ª–æ–≤—ã –≤–Ω–∏–º–∞–Ω–∏—è:** 6  
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:** 384
- **–†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞:** 256
- **–†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞:** 64
- **–î–∞—Ç–∞—Å–µ—Ç:** Shakespeare (character-level)
- **–ò—Ç–µ—Ä–∞—Ü–∏–∏:** 500 (–±—ã—Å—Ç—Ä—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã)

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **baseline** - –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –±–µ–∑ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
2. **qk_centered** - –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ query/key –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ attention
3. **final_centered** - –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
4. **full_centered** - –ü–æ–ª–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (Q/K + —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏)
5. **momentum_centered** - –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å momentum (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è)

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Validation Loss (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ):

| –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç | Final Val Loss | –£–ª—É—á—à–µ–Ω–∏–µ vs Baseline |
|-------------|----------------|------------------------|
| **momentum_centered** | **1.7094** | **+0.32%** ‚úÖ |
| baseline | 1.7149 | - |
| final_centered | 1.7164 | -0.09% |
| full_centered | 1.7166 | -0.10% |
| qk_centered | 1.7220 | -0.41% |

### üèÜ –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å momentum**

## üîç –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
1. **Momentum —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–∫–∞–∑–∞–ª–æ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (+0.32% —É–ª—É—á—à–µ–Ω–∏–µ)
2. –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
3. –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
4. –ú–æ–¥—É–ª–∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª—è—é—Ç –º–∞–ª–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:
- **Batch 1:** 3.3M tokens/sec
- **Batch 16:** 3.5M tokens/sec  
- **Batch 64:** 1.9M tokens/sec
- –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã: ~5-10%

### üé≠ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑:
- –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É–≥–ª—ã –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏ (1.75x –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞)
- Momentum —Ä–µ–∂–∏–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –ø—Ä–æ—Å—Ç–æ–º—É

## üß™ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ú–æ–¥—É–ª—å VectorCentering:
```python
class VectorCentering(nn.Module):
    def __init__(self, config, mode='adaptive'):
        # mode: 'simple', 'adaptive', 'learnable_center', 'momentum'
    
    def forward(self, x):
        # –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–Ω–æ—Ä–º–∏—Ä–æ–≤–∫–∞
        center = x.mean(dim=0, keepdim=True)
        x_centered = x - center
        x_normalized = x_centered / (torch.norm(x_centered, dim=-1, keepdim=True) + eps)
        return x_normalized
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
- **CenteredCausalSelfAttention:** –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ Q/K –≤–µ–∫—Ç–æ—Ä–æ–≤
- **Block —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º:** –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–æ–≤ –±–ª–æ–∫–æ–≤
- **GPT —Å —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º:** –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ momentum —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –ª—É—á—à–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
2. **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –∫ —Ñ–∏–Ω–∞–ª—å–Ω—ã–º —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã, –∑–∞–º–µ—Ç–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ
3. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å —Å–∏–ª–æ–π —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `centering_strength`

### –î–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π:
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª—è—Ö –∏ –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö
2. –ò–∑—É—á–µ–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ downstream –∑–∞–¥–∞—á–∏
3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ç–µ—Ö–Ω–∏–∫–∞–º–∏ —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏
4. –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –º–æ–¥–µ–ª–∏

## üìÅ –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

- `model_with_centering.py` - –ú–æ–¥–µ–ª—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
- `train_centered.py` - –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
- `train_centering_experiments.py` - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
- `test_centering.py` - –¢–µ—Å—Ç—ã –∏ –±–µ–Ω—á–º–∞—Ä–∫–∏
- `compare_centering_results.py` - –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `centering_comparison.png` - –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `centering_test_results.png` - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –ø–æ–∫–∞–∑–∞–ª–∏, —á—Ç–æ **—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ —Å momentum** –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–µ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–∞—Ö. –¢–µ—Ö–Ω–∏–∫–∞ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∞ –¥–ª—è:

- –£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞—Ö
- –ë–æ—Ä—å–±—ã —Å –∞–Ω–∏–∑–æ—Ç—Ä–æ–ø–∏–µ–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
- –ü–æ–≤—ã—à–µ–Ω–∏—è –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–∏–≤–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ nanoGPT
